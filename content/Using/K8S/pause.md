


# Kubernetes Pause å®¹å™¨çš„ç”¨é€”

Pause å®¹å™¨æ˜¯ Kubernetes ä¸­ä¸€ä¸ªéå¸¸å°ä½†æå…¶é‡è¦çš„åŸºç¡€è®¾æ–½å®¹å™¨ã€‚å¾ˆå¤šäººä¼šå¿½ç•¥å®ƒ,ä½†å®ƒæ˜¯ Pod ç½‘ç»œå’Œå‘½åç©ºé—´å…±äº«çš„æ ¸å¿ƒã€‚

---

## ğŸ¯ æ ¸å¿ƒä½œç”¨

### 1. **ä½œä¸º Pod çš„"æ ¹å®¹å™¨"(Infrastructure Container)**

Pause å®¹å™¨æ˜¯æ¯ä¸ª Pod ä¸­**ç¬¬ä¸€ä¸ªå¯åŠ¨**çš„å®¹å™¨,å®ƒçš„ç”Ÿå‘½å‘¨æœŸä»£è¡¨æ•´ä¸ª Pod çš„ç”Ÿå‘½å‘¨æœŸã€‚

```
Pod ç”Ÿå‘½å‘¨æœŸ:
åˆ›å»º Pod â†’ å¯åŠ¨ Pause å®¹å™¨ â†’ å¯åŠ¨ä¸šåŠ¡å®¹å™¨ â†’ ... â†’ ä¸šåŠ¡å®¹å™¨ç»“æŸ â†’ åˆ é™¤ Pause å®¹å™¨ â†’ Pod é”€æ¯
```

### 2. **æŒæœ‰å’Œå…±äº« Linux å‘½åç©ºé—´**

Pause å®¹å™¨åˆ›å»ºå¹¶æŒæœ‰ä»¥ä¸‹å‘½åç©ºé—´,ä¾› Pod å†…å…¶ä»–å®¹å™¨å…±äº«:

- **Network Namespace** (ç½‘ç»œå‘½åç©ºé—´) - æœ€é‡è¦!
- **IPC Namespace** (è¿›ç¨‹é—´é€šä¿¡)
- **UTS Namespace** (ä¸»æœºå)

```bash
# æŸ¥çœ‹ Pod ä¸­çš„å®¹å™¨
docker ps | grep pause

# ä½ ä¼šçœ‹åˆ°ç±»ä¼¼è¾“å‡º:
# k8s_POD_mypod_default_xxx  k8s.gcr.io/pause:3.9
# k8s_app_mypod_default_xxx  myapp:latest
```

---

## ğŸŒ ç½‘ç»œå‘½åç©ºé—´å…±äº«(æœ€å…³é”®çš„ç”¨é€”)

### å·¥ä½œåŸç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Pod â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚   Pause     â”‚ â† åˆ›å»ºç½‘ç»œå‘½åç©ºé—´        â”‚
â”‚  â”‚  Container  â”‚ â† æ‹¥æœ‰ Pod IP            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚         â”‚ (å…±äº«ç½‘ç»œæ ˆ)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Container A â”‚Container Bâ”‚Container Câ”‚  â”‚
â”‚  â”‚  (ä¸šåŠ¡å®¹å™¨)  â”‚  (ä¸šåŠ¡å®¹å™¨)â”‚ (ä¸šåŠ¡å®¹å™¨) â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                            â”‚
â”‚  æ‰€æœ‰å®¹å™¨å…±äº«:                              â”‚
â”‚  - åŒä¸€ä¸ª IP åœ°å€ (Pod IP)                 â”‚
â”‚  - åŒä¸€ä¸ªç½‘ç»œæ¥å£                           â”‚
â”‚  - åŒä¸€ä¸ªç«¯å£ç©ºé—´                           â”‚
â”‚  - å¯ä»¥é€šè¿‡ localhost äº’ç›¸è®¿é—®              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å®é™…æ•ˆæœ

```yaml
# ç¤ºä¾‹ Pod
apiVersion: v1
kind: Pod
metadata:
  name: multi-container-pod
spec:
  containers:
  - name: nginx
    image: nginx
    ports:
    - containerPort: 80
  - name: sidecar
    image: busybox
    command: ['sh', '-c', 'while true; do wget -O- localhost:80; sleep 5; done']
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­:
- Pause å®¹å™¨åˆ›å»ºç½‘ç»œå‘½åç©ºé—´å¹¶è·å¾— Pod IP (å¦‚ 10.244.1.5)
- nginx å®¹å™¨åŠ å…¥è¿™ä¸ªç½‘ç»œå‘½åç©ºé—´,ç›‘å¬ 80 ç«¯å£
- sidecar å®¹å™¨ä¹ŸåŠ å…¥åŒä¸€ç½‘ç»œå‘½åç©ºé—´
- **sidecar å¯ä»¥é€šè¿‡ `localhost:80` è®¿é—® nginx**,å› ä¸ºå®ƒä»¬å…±äº«ç½‘ç»œæ ˆ

---

## ğŸ” ä¸ºä»€ä¹ˆéœ€è¦ Pause å®¹å™¨?

### é—®é¢˜åœºæ™¯:å¦‚æœæ²¡æœ‰ Pause å®¹å™¨

å‡è®¾ Pod ä¸­æœ‰ä¸¤ä¸ªå®¹å™¨ A å’Œ B:

```
åœºæ™¯ 1:å®¹å™¨ A å…ˆå¯åŠ¨,åˆ›å»ºç½‘ç»œå‘½åç©ºé—´
â”œâ”€ å®¹å™¨ A æŒæœ‰ç½‘ç»œå‘½åç©ºé—´ â†’ æ‹¥æœ‰ Pod IP
â””â”€ å®¹å™¨ B åŠ å…¥å®¹å™¨ A çš„ç½‘ç»œå‘½åç©ºé—´

é—®é¢˜:å¦‚æœå®¹å™¨ A å´©æºƒé‡å¯æˆ–è¢«åˆ é™¤,ç½‘ç»œå‘½åç©ºé—´æ¶ˆå¤±
â†’ å®¹å™¨ B å¤±å»ç½‘ç»œè¿æ¥
â†’ Pod IP æ”¹å˜
â†’ Service è·¯ç”±å¤±æ•ˆ âŒ
```

### è§£å†³æ–¹æ¡ˆ:å¼•å…¥ Pause å®¹å™¨

```
Pause å®¹å™¨(æŒæœ‰å‘½åç©ºé—´) â† æ°¸è¿œä¸ä¼šä¸»åŠ¨é€€å‡º
â”œâ”€ å®¹å™¨ A åŠ å…¥
â””â”€ å®¹å™¨ B åŠ å…¥

ä¼˜åŠ¿:
âœ… å®¹å™¨ A æˆ– B å´©æºƒä¸å½±å“ç½‘ç»œå‘½åç©ºé—´
âœ… Pod IP å§‹ç»ˆä¿æŒç¨³å®š
âœ… ä¸šåŠ¡å®¹å™¨å¯ä»¥ç‹¬ç«‹é‡å¯
âœ… ç®€åŒ–å®¹å™¨é—´çš„ä¾èµ–å…³ç³»
```

---

## ğŸ“¦ Pause å®¹å™¨çš„ç‰¹ç‚¹

### 1. **æå…¶ç²¾ç®€**
```dockerfile
# pause å®¹å™¨çš„ä»£ç åªæœ‰å‡ åè¡Œ C ä»£ç 
// æ ¸å¿ƒåŠŸèƒ½å°±æ˜¯:æ°¸è¿œ sleep
int main() {
    for (;;) pause();  // æ— é™æš‚åœ,ç­‰å¾…ä¿¡å·
    return 0;
}
```

é•œåƒå¤§å°:**çº¦ 700KB** (ç›¸æ¯”æ™®é€šé•œåƒåŠ¨è¾„å‡ ç™¾ MB)

### 2. **èµ„æºå ç”¨æä½**
```bash
# æŸ¥çœ‹ Pause å®¹å™¨èµ„æºå ç”¨
docker stats <pause-container-id>

# å…¸å‹è¾“å‡º:
# CPU: 0.00%
# MEM: 0.5 MiB
```

### 3. **ç”Ÿå‘½å‘¨æœŸç®¡ç†**
- Kubelet åˆ›å»º Pod æ—¶é¦–å…ˆå¯åŠ¨ Pause å®¹å™¨
- Pause å®¹å™¨é€€å‡º = Pod é”€æ¯
- ä¸šåŠ¡å®¹å™¨é‡å¯ä¸å½±å“ Pause å®¹å™¨

---

## ğŸ› ï¸ å®é™…ç”¨é€”åœºæ™¯

### åœºæ™¯ 1:Sidecar æ¨¡å¼

```yaml
# åº”ç”¨ + æ—¥å¿—æ”¶é›†å™¨
spec:
  containers:
  - name: app
    image: myapp
    volumeMounts:
    - name: logs
      mountPath: /var/log
  - name: log-collector
    image: fluentd
    volumeMounts:
    - name: logs
      mountPath: /var/log
```
- Pause å®¹å™¨ä¿è¯ä¸¤ä¸ªå®¹å™¨å¯ä»¥é€šè¿‡å…±äº«å·å’Œ localhost é€šä¿¡
- å³ä½¿ app é‡å¯,log-collector ä»èƒ½æ­£å¸¸å·¥ä½œ

### åœºæ™¯ 2:Service Mesh (å¦‚ Istio)

```yaml
# åº”ç”¨ + Envoy ä»£ç†
spec:
  containers:
  - name: app
    image: myapp
    ports:
    - containerPort: 8080
  - name: istio-proxy  # Envoy sidecar
    image: istio/proxyv2
```
- Pause å®¹å™¨æŒæœ‰ç½‘ç»œå‘½åç©ºé—´
- Envoy ä»£ç†æ‹¦æˆªæ‰€æœ‰è¿›å‡ºæµé‡
- åº”ç”¨æ— éœ€æ„ŸçŸ¥ä»£ç†å­˜åœ¨

### åœºæ™¯ 3:åˆå§‹åŒ–å’Œä¸»å®¹å™¨åä½œ

```yaml
spec:
  initContainers:
  - name: init-config
    image: busybox
    command: ['sh', '-c', 'echo "config" > /config/app.conf']
    volumeMounts:
    - name: config
      mountPath: /config
  containers:
  - name: app
    image: myapp
    volumeMounts:
    - name: config
      mountPath: /config
```
- Pause å®¹å™¨åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ä¿æŒç½‘ç»œå’Œ IPC å‘½åç©ºé—´ç¨³å®š

---

## ğŸ”§ æŸ¥çœ‹å’Œè°ƒè¯• Pause å®¹å™¨

### æŸ¥çœ‹ Pod ä¸­çš„ Pause å®¹å™¨
```bash
# æ–¹å¼ 1:é€šè¿‡ crictl (æ¨è)
crictl pods
crictl ps -a | grep pause

# æ–¹å¼ 2:é€šè¿‡ docker (å¦‚æœä½¿ç”¨ Docker è¿è¡Œæ—¶)
docker ps -a | grep pause
docker inspect <pause-container-id>

# æ–¹å¼ 3:æŸ¥çœ‹ Pod çš„å®¹å™¨åˆ—è¡¨
kubectl get pod <pod-name> -o jsonpath='{.status.containerStatuses[*].name}'
```

### Pause é•œåƒç‰ˆæœ¬
```bash
# æŸ¥çœ‹ kubelet ä½¿ç”¨çš„ pause é•œåƒ
kubectl get pod <pod-name> -o yaml | grep pause

# å¸¸è§ç‰ˆæœ¬:
# registry.k8s.io/pause:3.9 (æœ€æ–°)
# registry.k8s.io/pause:3.8
# k8s.gcr.io/pause:3.7
```

---

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆçœ‹ä¸åˆ° Pause å®¹å™¨?
**A:** ä½¿ç”¨ `kubectl get pods` ä¸ä¼šæ˜¾ç¤º Pause å®¹å™¨,å®ƒå¯¹ç”¨æˆ·æ˜¯é€æ˜çš„ã€‚éœ€è¦ä½¿ç”¨åº•å±‚è¿è¡Œæ—¶å‘½ä»¤(å¦‚ `crictl` æˆ– `docker ps`)æ‰èƒ½çœ‹åˆ°ã€‚

### Q2: Pause å®¹å™¨ä¼šå½±å“æ€§èƒ½å—?
**A:** å‡ ä¹ä¸ä¼šã€‚Pause å®¹å™¨åªå ç”¨çº¦ 0.5MB å†…å­˜,CPU ä½¿ç”¨ä¸º 0,ä¸æ‰§è¡Œä»»ä½•ä¸šåŠ¡é€»è¾‘ã€‚

### Q3: å¯ä»¥åˆ é™¤ Pause å®¹å™¨å—?
**A:** ä¸èƒ½æ‰‹åŠ¨åˆ é™¤ã€‚åˆ é™¤ Pause å®¹å™¨ä¼šå¯¼è‡´æ•´ä¸ª Pod è¢«é”€æ¯ã€‚

### Q4: ä¸åŒ Pod çš„ Pause å®¹å™¨æ˜¯å¦å…±äº«?
**A:** ä¸å…±äº«ã€‚æ¯ä¸ª Pod éƒ½æœ‰ç‹¬ç«‹çš„ Pause å®¹å™¨,ç¡®ä¿ Pod ä¹‹é—´çš„ç½‘ç»œå’Œå‘½åç©ºé—´éš”ç¦»ã€‚

---

## ğŸ“ æ€»ç»“

| ç”¨é€” | è¯´æ˜ |
|------|------|
| **å‘½åç©ºé—´æŒæœ‰è€…** | åˆ›å»ºå¹¶æŒæœ‰ Networkã€IPCã€UTS å‘½åç©ºé—´ |
| **ç½‘ç»œåŸºç¡€** | ä½¿ Pod å†…æ‰€æœ‰å®¹å™¨å…±äº«åŒä¸€ IP å’Œç½‘ç»œæ ˆ |
| **ç”Ÿå‘½å‘¨æœŸé”šç‚¹** | ä»£è¡¨ Pod çš„ç”Ÿå‘½å‘¨æœŸ,å®¹å™¨å¯ç‹¬ç«‹é‡å¯ |
| **ç®€åŒ–æ¶æ„** | è§£è€¦å®¹å™¨é—´ä¾èµ–,é¿å…çº§è”æ•…éšœ |
| **èµ„æºé«˜æ•ˆ** | æå°çš„é•œåƒå’Œèµ„æºå ç”¨ |

**æ ¸å¿ƒä»·å€¼**: Pause å®¹å™¨æ˜¯ Kubernetes Pod æŠ½è±¡çš„åŸºçŸ³,è®©å¤šä¸ªå®¹å™¨èƒ½åƒåœ¨åŒä¸€ä¸»æœºä¸Šä¸€æ ·åä½œ,åŒæ—¶ä¿æŒå„è‡ªçš„ç‹¬ç«‹æ€§å’Œå¯é‡å¯æ€§ã€‚

éœ€è¦æˆ‘è¯¦ç»†è®²è§£æŸä¸ªå…·ä½“åœºæ™¯æˆ–æ·±å…¥æ¢è®¨å®ç°åŸç†å—? ğŸš€